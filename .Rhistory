)
leaflet(n_pop_2010_2020) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 0.75,
label = ~paste0(round(absolute_pop))
) %>%
addLegend(
pal = absolute_pal,
values = ~absolute_pop,
title = "Total Population Change in Napa"
)
projection <- "+proj=utm +zone=10 +ellps=GRS80 +datum=NAD83 +units=ft +no_defs"
n_pop_2010_2020 <- n_blocks_2010 %>%
left_join(place_blocks_2020_reshaped) %>%
mutate(
absolute_pop = (pop_2020 - pop_2010) / as.numeric(st_area(.)) * 43560
)
absolute_pal <- colorNumeric(
palette = "Blues",
domain = n_pop_2010_2020$absolute_pop
)
leaflet(n_pop_2010_2020) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 0.75,
label = ~paste0(round(absolute_pop))
) %>%
addLegend(
pal = absolute_pal,
values = ~absolute_pop,
title = "Total Population Change in Napa"
)
leaflet(n_pop_2010_2020) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 0.75,
label = ~paste0(round(absolute_pop))
) %>%
addLegend(
pal = absolute_pal,
values = ~absolute_pop,
title = "Total Population Change in Napa"
)
nc_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Napa")
nc_blocks_2010 <- blocks_2010 %>%
st_centroid() %>%
.[nc_boundary, ] %>%
st_drop_geometry() %>%
left_join(blocks_2010 %>% select(GEOID10))%>%
st_as_sf() %>%
select(GEOID10) %>%
left_join(nc_pop_2010)
mapview(nc_boundary) + mapview(nc_blocks_2010, alpha.regions = 0, color = "red", lwd = 2)
place_blocks_2020 <- blocks_2020 %>%
.[nc_boundary, ] %>%
select(GEOID20) %>%
left_join(nc_pop_2020)
nc_blocks_2020_intersect <- nc_blocks_2020 %>%
st_transform(26910) %>%
mutate(original_area = st_area(.)) %>%
st_intersection(
nc_blocks_2010 %>%
select(GEOID10) %>%
st_transform(26910)
) %>%
mutate(
leftover_area = st_area(.),
perc_area = as.numeric(leftover_area / original_area),
pop_2020 = pop_2020 * perc_area
)
projection <- "+proj=utm +zone=10 +ellps=GRS80 +datum=NAD83 +units=ft +no_defs"
n_pop_2010_2020 <- n_blocks_2010 %>%
left_join(place_blocks_2020_reshaped) %>%
mutate(
absolute_pop = (pop_2020 - pop_2010) / as.numeric(st_area(.)) * 43560
)
absolute_pal <- colorNumeric(
palette = "Blues",
domain = n_pop_2010_2020$absolute_pop
)
leaflet(n_pop_2010_2020) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 0.75,
label = ~paste0(round(absolute_pop))
) %>%
addLegend(
pal = absolute_pal,
values = ~absolute_pop,
title = "Total Population Change in Napa"
)
n_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Napa")
n_blocks_2010 <- blocks_2010 %>%
st_centroid() %>%
.[n_boundary, ] %>%
st_drop_geometry() %>%
left_join(blocks_2010 %>% select(GEOID10))%>%
st_as_sf() %>%
select(GEOID10) %>%
left_join(nc_pop_2010)
mapview(n_boundary) + mapview(n_blocks_2010, alpha.regions = 0, color = "red", lwd = 2)
dec_vars_2010 <-
listCensusMetadata(
name = "2010/dec/pl",
type = "variables"
)
nc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:055",
vars = "P001001"
) %>%
transmute(
GEOID10 =  paste0(state,county,tract,block),
pop_2010 = P001001
)
blocks_2010 <- blocks("CA", "Napa County", year = 2010, progress_bar = F)
dec_vars_2010 <-
listCensusMetadata(
name = "2010/dec/pl",
type = "variables"
)
nc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:055",
vars = "P001001"
) %>%
transmute(
GEOID10 =  paste0(state,county,tract,block),
pop_2010 = P001001
)
blocks_2010 <- blocks("CA", "Napa County", year = 2010, progress_bar = F)
dec_vars_2020 <-
listCensusMetadata(
name = "2020/dec/pl",
type = "variables"
)
nc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:055",
vars = "P1_001N"
) %>%
transmute(
GEOID20 = paste0(state,county,tract,block),
pop_2020 = P1_001N
)
blocks_2020 <- blocks("CA", "Napa County", year = 2020, progress_bar = F)
dec_vars_2020 <-
listCensusMetadata(
name = "2020/dec/pl",
type = "variables"
)
nc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:055",
vars = "P1_001N"
) %>%
transmute(
GEOID20 = paste0(state,county,tract,block),
pop_2020 = P1_001N
)
blocks_2020 <- blocks("CA", "Napa County", year = 2020, progress_bar = F)
dec_vars_2010 <-
listCensusMetadata(
name = "2010/dec/pl",
type = "variables"
)
nc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:055",
vars = "P001001"
) %>%
transmute(
GEOID10 =  paste0(state,county,tract,block),
pop_2010 = P001001
)
blocks_2010 <- blocks("CA", "Napa County", year = 2010, progress_bar = F)
nc_boundary <- ncs("CA", progress_bar = F) %>%
filter(NAME == "Napa")
nc_boundary <- place("CA", progress_bar = F) %>%
filter(NAME == "Napa")
nc_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Napa")
nc_blocks_2010 <- blocks_2010 %>%
st_centroid() %>%
.[nc_boundary, ] %>%
st_drop_geometry() %>%
left_join(blocks_2010 %>% select(GEOID10))%>%
st_as_sf() %>%
select(GEOID10) %>%
left_join(nc_pop_2010)
mapview(nc_boundary) + mapview(nc_blocks_2010, alpha.regions = 0, color = "red", lwd = 2)
nc_blocks_2020 <- blocks_2020 %>%
.[nc_boundary, ] %>%
select(GEOID20) %>%
left_join(nc_pop_2020)
nc_blocks_2020_intersect <- nc_blocks_2020 %>%
st_transform(26910) %>%
mutate(original_area = st_area(.)) %>%
st_intersection(
n_blocks_2010 %>%
select(GEOID10) %>%
st_transform(26910)
) %>%
mutate(
leftover_area = st_area(.),
perc_area = as.numeric(leftover_area / original_area),
pop_2020 = pop_2020 * perc_area
)
nc_blocks_2020_reshaped <- nc_blocks_2020_intersect %>%
st_drop_geometry() %>%
group_by(GEOID10) %>%
summarize(
pop_2020 = sum(pop_2020, na.rm=T) %>% round()
)
projection <- "+proj=utm +zone=10 +ellps=GRS80 +datum=NAD83 +units=ft +no_defs"
n_pop_2010_2020 <- n_blocks_2010 %>%
left_join(nc_blocks_2020_reshaped) %>%
mutate(
absolute_pop = (pop_2020 - pop_2010) / as.numeric(st_area(.)) * 43560
)
absolute_pal <- colorNumeric(
palette = "Blues",
domain = n_pop_2010_2020$absolute_pop
)
leaflet(n_pop_2010_2020) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 0.75,
label = ~paste0(round(absolute_pop))
) %>%
addLegend(
pal = absolute_pal,
values = ~absolute_pop,
title = "Total Population Change in Napa"
)
max <- max(absolute_pop)
max <- max(~absolute_pop)
max <- max(abs(nc_pop_2010), abs(nc_pop_2020))
max <- max(abs(-n_pop_2010_2020), abs(n_pop_2010_2020))
max <- max(abs(~n_pop_2010_2020), abs(~n_pop_2010_2020))
max <- max(abs(as.numeric(nc_pop_2020)), abs(as.numeric(nc_pop_2020))
absolute_pal <- colorNumeric(
max <- max(abs(as.numeric(-nc_pop_2020)), abs(as.numeric(nc_pop_2020))
absolute_pal <- colorNumeric(
absolute_pal <- colorNumeric(
palette = "PiYG",
domain = n_pop_2010_2020$absolute_pop
)
leaflet(n_pop_2010_2020) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 0.75,
label = ~paste0(round(absolute_pop))
) %>%
addLegend(
pal = absolute_pal,
values = ~absolute_pop,
title = "Total Population Change in Napa"
)
View(nc_blocks_2020_reshaped)
leaflet(n_pop_2010_2020) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
color = "gold",
opacity = 0.5,
fillOpacity = 0.75,
weight = 0.75,
label = ~paste0(round(absolute_pop))
) %>%
addLegend(
pal = absolute_pal,
values = ~absolute_pop,
title = "Total Population Change in Napa"
)
leaflet(n_pop_2010_2020) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
color = "black",
opacity = 0.5,
fillOpacity = 0.75,
weight = 0.75,
label = ~paste0(round(absolute_pop))
) %>%
addLegend(
pal = absolute_pal,
values = ~absolute_pop,
title = "Total Population Change in Napa"
)
setwd("~/Desktop/GitHub/kflorsheim.github.io")
setwd("~/Desktop/GitHub/kflorsheimi.github.io")
leaflet(n_pop_2010_2020) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
color = "black",
opacity = 0.5,
fillOpacity = 0.75,
weight = 0.75,
label = ~paste0(round(absolute_pop))
) %>%
addLegend(
pal = absolute_pal,
values = ~absolute_pop,
title = "Total Population Change in Napa"
)
absolute_pal <- colorNumeric(
palette = "PiYG",
domain = n_pop_2010_2020$absolute_pop
)
projection <- "+proj=utm +zone=10 +ellps=GRS80 +datum=NAD83 +units=ft +no_defs"
n_pop_2010_2020 <- n_blocks_2010 %>%
left_join(nc_blocks_2020_reshaped) %>%
mutate(
absolute_pop = (pop_2020 - pop_2010) / as.numeric(st_area(.)) * 43560
)
library(tidyverse)
library(sf)
library(tigris)
library(mapview)
library(leaflet)
library(censusapi)
Sys.setenv(CENSUS_KEY="9fbd5ddd430b595b8f3715733cae2b75c18be92e")
knitr::opts_chunk$set(echo = F, warning = F, message = F)
dec_vars_2020 <-
listCensusMetadata(
name = "2020/dec/pl",
type = "variables"
)
nc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:055",
vars = "P1_001N"
) %>%
transmute(
GEOID20 = paste0(state,county,tract,block),
pop_2020 = P1_001N
)
blocks_2020 <- blocks("CA", "Napa County", year = 2020, progress_bar = F)
dec_vars_2010 <-
listCensusMetadata(
name = "2010/dec/pl",
type = "variables"
)
nc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:055",
vars = "P001001"
) %>%
transmute(
GEOID10 =  paste0(state,county,tract,block),
pop_2010 = P001001
)
blocks_2010 <- blocks("CA", "Napa County", year = 2010, progress_bar = F)
nc_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Napa")
nc_blocks_2010 <- blocks_2010 %>%
st_centroid() %>%
.[nc_boundary, ] %>%
st_drop_geometry() %>%
left_join(blocks_2010 %>% select(GEOID10))%>%
st_as_sf() %>%
select(GEOID10) %>%
left_join(nc_pop_2010)
mapview(nc_boundary) + mapview(nc_blocks_2010, alpha.regions = 0, color = "red", lwd = 2)
nc_blocks_2020_intersect <- nc_blocks_2020 %>%
st_transform(26910) %>%
mutate(original_area = st_area(.)) %>%
st_intersection(
n_blocks_2010 %>%
select(GEOID10) %>%
st_transform(26910)
) %>%
mutate(
leftover_area = st_area(.),
perc_area = as.numeric(leftover_area / original_area),
pop_2020 = pop_2020 * perc_area
)
nc_blocks_2020_reshaped <- nc_blocks_2020_intersect %>%
st_drop_geometry() %>%
group_by(GEOID10) %>%
summarize(
pop_2020 = sum(pop_2020, na.rm=T) %>% round()
)
projection <- "+proj=utm +zone=10 +ellps=GRS80 +datum=NAD83 +units=ft +no_defs"
n_pop_2010_2020 <- n_blocks_2010 %>%
left_join(nc_blocks_2020_reshaped) %>%
mutate(
absolute_pop = (pop_2020 - pop_2010) / as.numeric(st_area(.)) * 43560
)
absolute_pal <- colorNumeric(
palette = "PiYG",
domain = n_pop_2010_2020$absolute_pop
)
leaflet(n_pop_2010_2020) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
color = "black",
opacity = 0.5,
fillOpacity = 0.75,
weight = 0.75,
label = ~paste0(round(absolute_pop))
) %>%
addLegend(
pal = absolute_pal,
values = ~absolute_pop,
title = "Total Population Change in Napa"
)
leaflet(n_pop_2010_2020) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
color = "black",
opacity = 0.5,
fillOpacity = 0.75,
weight = 0.75,
label = ~paste0(round(absolute_pop))
) %>%
addLegend(
pal = absolute_pal,
values = ~absolute_pop,
title = "Total Population Change in Napa"
)
nc_blocks_2020_intersect <- nc_blocks_2020 %>%
st_transform(26910) %>%
mutate(original_area = st_area(.)) %>%
st_intersection(
nc_blocks_2010 %>%
select(GEOID10) %>%
st_transform(26910)
) %>%
mutate(
leftover_area = st_area(.),
perc_area = as.numeric(leftover_area / original_area),
pop_2020 = pop_2020 * perc_area
)
nc_blocks_2020_reshaped <- nc_blocks_2020_intersect %>%
st_drop_geometry() %>%
group_by(GEOID10) %>%
summarize(
pop_2020 = sum(pop_2020, na.rm=T) %>% round()
)
View(n_pop_2010_2020)
View(n_pop_2010_2020)
setwd("~/Desktop/GitHub/kflorsheim.github.io")
knitr::opts_chunk$set(echo = F, warning = F, message = F)
leaflet(n_pop_2010_2020) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
color = "black",
opacity = 0.5,
fillOpacity = 0.75,
weight = 0.75,
label = ~paste0(round(absolute_pop))
) %>%
addLegend(
pal = absolute_pal,
values = ~absolute_pop,
title = "Total Population Change in Napa"
)
setwd("~/Desktop/GitHub/kflorsheim.github.io")
